<!DOCTYPE html>
<html lang="ar">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>سلة المشتريات</title>
    <style>
      body {
        text-align: center;
        font-family: "Tajawal", sans-serif;
        color: white;
        background-color: #111;
        margin: 0;
        padding: 0;
      }

      header {
        background: rgba(0, 0, 0, 0.8);
        padding: 15px;
        text-align: center;
        width: 100%;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 1000;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 5px 15px rgba(255, 255, 255, 0.2);
      }

      header h1 {
        flex-grow: 1;
        font-size: 24px;
      }

      .back-button {
        background: #0077ff;
        color: white;
        padding: 10px 15px;
        border: none;
        cursor: pointer;
        border-radius: 8px;
        font-size: 14px;
        transition: 0.3s;
      }

      .back-button:hover {
        background: #0077ff;
      }

      /* 🔹 اختيار العملة */
      select {
        padding: 8px;
        border-radius: 5px;
        font-size: 14px;
        background: #333;
        color: white;
        border: none;
        cursor: pointer;
      }

      .cart-container {
        margin-top: 80px;
        padding: 20px;
      }

      .cart-item {
        background: rgba(255, 255, 255, 0.1);
        margin: 10px auto;
        padding: 15px;
        border-radius: 10px;
        width: 50%;
        text-align: center;
        box-shadow: 0 5px 10px rgba(255, 255, 255, 0.2);
      }

      .cart-item p {
        font-size: 18px;
        color: #9b59b6;
      }

      .remove-btn {
        background: #0077ff;
        color: white;
        padding: 8px;
        border: none;
        cursor: pointer;
        border-radius: 8px;
        margin-top: 10px;
        transition: 0.3s;
      }

      .remove-btn:hover {
        background: #c0392b;
      }

      .clear-cart {
        background: #0077ff;
        color: white;
        padding: 10px 15px;
        border: none;
        cursor: pointer;
        border-radius: 8px;
        font-size: 16px;
        margin-top: 20px;
        transition: 0.3s;
      }

      .clear-cart:hover {
        background: #e84118;
      }

      /* 🔹 زر الدفع عبر PayPal */
      .paypal-button {
        background: #0070ba;
        color: white;
        padding: 12px 20px;
        border: none;
        cursor: pointer;
        border-radius: 8px;
        font-size: 16px;
        margin-top: 15px;
        transition: 0.3s;
        display: none; /* مخفي حتى يتم إضافة منتجات للسلة */
      }

      .paypal-button:hover {
        background: #005ea6;
      }
    </style>
  </head>
  <body>
    <header>
      <button class="back-button" onclick="goBack()">🔙 رجوع</button>
      <h1>🛒 سلة المشتريات</h1>
      <select id="currency-selector" onchange="changeCurrency()">
        <option value="SAR">🇸🇦 SAR</option>
        <option value="USD">🇺🇸 USD</option>
        <option value="EUR">🇪🇺 EUR</option>
      </select>
    </header>

    <div class="cart-container" id="cart-container">
      <h2>📦 المنتجات المضافة:</h2>
      <div id="cart-items"></div>
      <button class="clear-cart" onclick="clearCart()">🗑️ مسح السلة</button>
      <button
        class="paypal-button"
        id="paypal-button"
        onclick="payWithPayPal()"
      >
        💳 الدفع عبر PayPal
      </button>
    </div>

    <script>
      function goBack() {
        window.location.href = "products.html"; // الرجوع للمنتجات
      }

      function loadCart() {
        let cart = JSON.parse(localStorage.getItem("cart")) || [];
        let cartContainer = document.getElementById("cart-items");
        let paypalButton = document.getElementById("paypal-button");

        cartContainer.innerHTML = "";

        if (cart.length === 0) {
          cartContainer.innerHTML = "<p>🛑 السلة فارغة!</p>";
          paypalButton.style.display = "none"; // إخفاء زر الدفع
          return;
        }

        paypalButton.style.display = "inline-block"; // إظهار زر الدفع عند وجود منتجات

        cart.forEach((item, index) => {
          let itemDiv = document.createElement("div");
          itemDiv.classList.add("cart-item");
          itemDiv.innerHTML = `
                    <p>🛍️ ${item.name} - 💰 <span class="price" data-original="${item.price}">${item.price}</span> <span class="currency">SAR</span></p>
                    <button class="remove-btn" onclick="removeFromCart(${index})">❌ إزالة</button>
                `;
          cartContainer.appendChild(itemDiv);
        });

        updateCurrency();
      }

      function removeFromCart(index) {
        let cart = JSON.parse(localStorage.getItem("cart")) || [];
        cart.splice(index, 1);
        localStorage.setItem("cart", JSON.stringify(cart));
        loadCart();
      }

      function clearCart() {
        localStorage.removeItem("cart");
        loadCart();
      }

      function changeCurrency() {
        let selectedCurrency = document.getElementById("currency-selector")
          .value;
        localStorage.setItem("selectedCurrency", selectedCurrency);
        updateCurrency();
      }

      function updateCurrency() {
        let selectedCurrency =
          localStorage.getItem("selectedCurrency") || "SAR";
        let exchangeRates = {
          SAR: 1,
          USD: 0.27,
          EUR: 0.25
        };

        let prices = document.querySelectorAll(".price");
        let currencyLabels = document.querySelectorAll(".currency");

        prices.forEach((price, index) => {
          let originalPrice = parseFloat(price.getAttribute("data-original"));
          let convertedPrice = (
            originalPrice * exchangeRates[selectedCurrency]
          ).toFixed(2);
          price.textContent = convertedPrice;
          currencyLabels[index].textContent = selectedCurrency;
        });

        document.getElementById("currency-selector").value = selectedCurrency;
      }

      function payWithPayPal() {
        let totalAmount = 0;
        let selectedCurrency =
          localStorage.getItem("selectedCurrency") || "SAR";
        let cart = JSON.parse(localStorage.getItem("cart")) || [];

        cart.forEach(item => {
          totalAmount += parseFloat(item.price);
        });

        // تحويل المبلغ إلى PayPal بصيغة URL
        let paypalUrl = `https://www.paypal.com/checkoutnow?amount=${totalAmount}&currency=${selectedCurrency}`;
        window.open(paypalUrl, "_blank");
      }

      document.addEventListener("DOMContentLoaded", function() {
        loadCart();
        updateCurrency();
      });
    </script>
  </body>
</html>
